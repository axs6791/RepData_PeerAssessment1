---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
    theme: darkly
---

## Loading and preprocessing the data

The activity data is provided in a *zip* file. The preprocess step consists in unziping the file, loading the uncompressed *csv* file into a dataframe, and then converting the date column into date type. 

```{r, echo=TRUE}
unzip("activity.zip")
if (file.exists("activity.csv")){
    activity_data <- read.csv("activity.csv", header = TRUE)
    tmp<-file.remove("activity.csv")
}
activity_data$date<-as.Date(activity_data$date, format="%Y-%m-%d")
```

The process data frame looks like this:
```{r, echo=TRUE}
str(activity_data)
```

## What is the mean total number of steps taken per day?
The following three plots show the total, mean and median number of steps per day taken.
```{r, echo=TRUE, message=FALSE}
library(gridExtra)
library(dplyr)
library(ggplot2)

# Just keep the date and step data, remove NAs and group by date.
steps_grouped_by_date <- activity_data %>%
    select(date, steps) %>%
    filter(!is.na(steps)) %>%
    group_by(date)

# Compute the number of total steps per day
steps_data <- steps_grouped_by_date %>%
    summarise(count=sum(steps))

# Compute the number of average of steps per day
# and add it to the dataframe
tmp <- steps_grouped_by_date %>%
    summarise(mean=mean(steps))
steps_data$mean <- tmp$mean

gg <- ggplot(steps_data, aes(x=date, y=count)) 
p1 <- gg + geom_bar(stat="identity", fill="steelblue") +
    ggtitle("Total Steps per Day") + 
    theme(axis.title.x = element_blank(),
          axis.title.y = element_blank())
p2 <- gg + geom_line(inherit.aes = FALSE, aes(x=date, y=mean), 
                     color="steelblue") + 
    ggtitle("Mean Steps per Day") + 
    theme(axis.title.x = element_blank(),
          axis.title.y = element_blank())

grid.arrange(p1,p2,nrow=1, left="Steps", bottom="Date")
```

Looking at more detail the total number of steps:
```{r echo=TRUE}
summary(steps_data$count)
```


## What is the average daily activity pattern?
The average daily activity patter can be visualized by looking at the average number of steps taken by time interval of the day.

```{r, echo=TRUE, message=FALSE}
steps_by_interval <-
    activity_data %>%
    select(interval, steps) %>%
    filter(!is.na(steps)) %>%
    group_by(interval) %>%
    summarise(mean = mean(steps))

ggplot(steps_by_interval, aes(x = interval, y = mean)) +
    geom_line(color = "steelblue", size = 2) +
    xlab("5 Min Interval of the Day") +
    ylab("Average Steps")
    
```
One can see in the time series, that there is a clear peak. The time interval and max average steps can be found as follows:

```{r, echo=TRUE, message=FALSE}
steps_by_interval[which.max(steps_by_interval$mean),]
```
## Imputing missing values



## Are there differences in activity patterns between weekdays and weekends?
